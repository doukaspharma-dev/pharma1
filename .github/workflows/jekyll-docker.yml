<!DOCTYPE html>
<html lang="el">
<head>
<meta charset="UTF-8">
<title>Î¤Î± Î´Î¹ÎºÎ¬ Î¼Î¿Ï… Ï‡ÏÎ®ÏƒÎ¹Î¼Î±</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link id="favicon" rel="icon" href="">
<style>
/* ===== Î§Î¡Î©ÎœÎ‘Î¤Î‘ Î˜Î•ÎœÎ‘Î¤ÎŸÎ£ ===== */
:root{
  --bg1:#0d1b2a; --bg2:#1b263b; --card:#415a77; --text:#e0e1dd; --accent:#f4a261;
  --border:rgba(255,255,255,.15);
}

/* Reset */
*{box-sizing:border-box}
body{margin:0;background:linear-gradient(160deg,var(--bg1),var(--bg2));
  color:var(--text);font-family:Arial,Helvetica,sans-serif;}
/* Î¼ÎµÎ¹Ï‰Î¼Î­Î½Î± Ï€Î»Î¬Î³Î¹Î± Ï€ÎµÏÎ¹Î¸ÏÏÎ¹Î± + extra ÎºÎ¬Ï„Ï‰ Î³Î¹Î± footer */
.wrap{max-width:1200px;margin:0 auto;padding:24px 10px 210px;}

/* ===== HEADER ===== */
header{text-align:center;margin-bottom:10px;}
header h1{margin:4px 0 0;font-size:26px;font-weight:800;}
header h2{margin:6px 0 0;font-size:14px;color:#2a9df4;font-weight:700;}
header h3{margin:6px 0 0;font-size:13px;color:#bbb;font-weight:500;}
#themeToggle {
  margin-top:8px;
  padding:6px 14px;
  border-radius:8px;
  border:none;
  cursor:pointer;
  background:var(--accent);
  color:#fff;          /* ğŸ‘ˆ Î Î¬Î½Ï„Î± Î»ÎµÏ…ÎºÎ¬ Î³ÏÎ¬Î¼Î¼Î±Ï„Î± */
  font-weight:700;
  font-size:15px;
}

/* ===== TOPBAR BUTTONS ===== */
.topbar{display:flex;flex-wrap:wrap;justify-content:center;gap:10px;margin:12px 0 18px;}
button{padding:8px 14px;border:none;border-radius:10px;cursor:pointer;
  background:var(--accent);color:#fff;;font-weight:700;font-size:14px;}
button.gray{background:#596070 !important;color:#ccc !important;}
button:disabled{opacity:.45;cursor:not-allowed;}

/* ===== ÎšÎ‘Î¤Î—Î“ÎŸÎ¡Î™Î•Î£ ===== */
#categories{display:flex;flex-direction:column;gap:18px;padding:0 6px;}
.category{background:rgba(255,255,255,.04);border:1px solid var(--border);
  border-radius:14px;padding:10px;}
.category.drag-over{outline:2px dashed #5aa9ff;outline-offset:4px;}
.category-title{display:flex;align-items:center;justify-content:space-between;position:relative;}
.category-title h2{margin:0;font-size:18px;}
.cat-actions{display:flex;gap:6px;opacity:0;transition:.2s;position:absolute;right:0;top:0;}
.category-title:hover .cat-actions{opacity:1;}
.cat-btn{cursor:pointer;font-size:12px;padding:2px 6px;border-radius:6px;
  background:rgba(0,0,0,.45);color:var(--text);}
.cat-btn:hover{background:rgba(0,0,0,.75);}

/* ===== GRID & CARDS ===== */
/* ÎµÎ»Î±Ï†ÏÏÏ‚ Î¼ÎµÎ³Î±Î»ÏÏ„ÎµÏÎµÏ‚ ÎºÎ¬ÏÏ„ÎµÏ‚ + Î»Î¯Î³Î¿ Ï€Î¹Î¿ Î±ÏÎ±Î¹ÏŒ ÎºÎµÎ½ÏŒ */
.grid{display:grid;grid-template-columns:repeat(10,1fr);gap:12px;margin-top:10px;min-height:44px;}
.card{
  background:var(--card);border:1px solid var(--border);border-radius:22px;
  width:100%;aspect-ratio:1/1;position:relative;overflow:hidden;
  display:flex;align-items:center;justify-content:center;transition:.18s ease;
  padding:10px; /* ğŸ‘‰ Î³Î¹Î± Î½Î± Î¼Î·Î½ ÎºÎ¿Î»Î»Î¬ Ï„Î¿ Ï€ÎµÏÎ¹ÎµÏ‡ÏŒÎ¼ÎµÎ½Î¿ ÏƒÏ„Î¿ Ï€ÎµÏÎ¯Î³ÏÎ±Î¼Î¼Î± */
}
.card:hover{
  transform:translateY(-3px);
  background: color-mix(in oklab, var(--accent) 20%, transparent);
  border-color:var(--accent);
}
/* â• Î•Î¼Ï†Î¬Î½Î¹ÏƒÎ· ÏŒÏ„Î±Î½ ÎµÎ¯Î½Î±Î¹ pinned */
.card.pinned{
  outline:2px solid gold; outline-offset:-2px;
  box-shadow:0 0 0 2px rgba(255,215,0,.25) inset;
}

.card a{
  display:flex;flex-direction:column;align-items:center;text-decoration:none;
  color:var(--text);width:100%;height:100%;justify-content:center;
}
.card img.favicon{width:48px;height:48px;margin-bottom:8px;display:block;image-rendering:auto;}
.link-title{
  font-size:13px;font-weight:800;color:var(--text);
  white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:90%;
}
.link-desc{
  font-size:11px;color:rgba(255,255,255,.6);margin-top:2px;
  max-width:90%;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
}

/* ÎšÎ¿Ï…Î¼Ï€Î¹Î¬ Ï€Î¬Î½Ï‰ ÏƒÏ„Î¹Ï‚ ÎºÎ¬ÏÏ„ÎµÏ‚ (SVG, Î´Î¹Î±Ï†Î±Î½Î®) */
.ctrl-left,.ctrl-right{position:absolute;top:6px;display:flex;gap:6px;opacity:0;transition:.2s;}
.card:hover .ctrl-left,.card:hover .ctrl-right{opacity:1;}
.ctrl-left{left:6px;} .ctrl-right{right:6px;}
/* â• ÎšÎ¿Ï…Î¼Ï€Î¯ pin ÎºÎ¬Ï„Ï‰ Î±ÏÎ¹ÏƒÏ„ÎµÏÎ¬ */
.ctrl-bottom{position:absolute;left:6px;bottom:6px;opacity:0;transition:.2s;}
.card:hover .ctrl-bottom{opacity:1;}

.ctrl-btn{
  background:transparent;border:none;padding:0;margin:0;cursor:pointer;line-height:0;display:flex;
}
.ctrl-btn svg{width:20px;height:20px;display:block;}
.ctrl-btn:hover{transform:scale(1.14);}

/* ===== FOOTER ===== */
footer{
  position:fixed;left:0;bottom:0;width:100%;
  background:rgba(35,36,41,.96);backdrop-filter:blur(6px);
  border-top:1px solid var(--border);padding:22px 10px;z-index:3000;text-align:center;
}
footer .btnrow{display:flex;flex-wrap:wrap;justify-content:center;gap:10px;margin-bottom:6px;}
footer .note{color:#aab2bd;font-weight:700;}
body:has(footer) .wrap{padding-bottom:210px;}

/* ===== MODALS ===== */
.modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;
  background:rgba(0,0,0,.6);z-index:4000;}
.modal .box{background:var(--bg2);border:1px solid var(--border);border-radius:14px;
  padding:16px;width:94%;max-width:420px;}
.modal h3{margin:0 0 8px;font-size:18px;}
.modal .row{display:flex;flex-direction:column;gap:6px;margin:8px 0;}
.modal input,.modal textarea,select{
  background:var(--card);color:var(--text);border:1px solid var(--border);
  border-radius:8px;padding:8px;width:100%;
}
.modal .actions{display:flex;gap:8px;justify-content:flex-end;margin-top:6px;}

/* Icon picker rows */
.icon-row{display:flex;gap:8px;align-items:center;flex-wrap:wrap;}
.icon-row select,.icon-row input[type=file]{flex:1;}
.icon-preview{display:flex;align-items:center;gap:8px;margin-top:4px;font-size:12px;color:#cbd5e1;}
.icon-preview img{width:24px;height:24px;}

/* ÎšÎ¿Ï…Î¼Ï€Î¯ Ï€Î±Î»Î­Ï„Î±Ï‚ (Î±ÏŒÏÎ±Ï„Î¿ Î±Î»Î»Î¬ clickable) -- Î¼ÎµÎ³Î±Î»ÏÏƒÎ±Î¼Îµ ÏƒÎµ 64x64 */
#paletteBtn{position:fixed;top:50%;right:0;transform:translateY(-50%);
  width:64px;height:64px;opacity:0;cursor:pointer;z-index:4500;}

/* palette swatches inside modal */
.palette-row{display:flex;align-items:center;gap:12px;}
.color-swatch{width:48px;height:48px;border-radius:8px;border:1px solid var(--border);flex-shrink:0;}

/* ===== TOOLTIP (pale) ===== */
/* ç•™: Keep tooltips available for other elements (topbar etc.), but
   we will not add data-tooltip to the card icon buttons so those won't show tooltips. */
[data-tooltip]{position:relative;}
[data-tooltip]::after{
  content:attr(data-tooltip);
  position:absolute;bottom:125%;left:50%;transform:translateX(-50%);
  background:#fff9c4;color:#0a58ca;border:1px solid rgba(10,88,202,.35);
  padding:4px 8px;border-radius:6px;white-space:nowrap;font-size:12px;font-weight:600;
  opacity:0;pointer-events:none;transition:opacity .2s;box-shadow:0 6px 18px rgba(0,0,0,.2);
}
[data-tooltip]:hover::after{opacity:1;}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <h1>Î¤Î± Î´Î¹ÎºÎ¬ Î¼Î¿Ï… Ï‡ÏÎ®ÏƒÎ¹Î¼Î±</h1>
    <h2>Î¦Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿ Î“ÎºÎ¯Î½Î·Ï‚ Î Î­Ï„ÏÎ¿Ï‚. Î Î¿Î»ÏÎ³Ï‰Î½Î¿.</h2>
    <h3>Î§ÏÎ®ÏƒÎ¹Î¼Î± ÎµÏÎ³Î±Î»ÎµÎ¯Î± ÎºÎ±Î¹ ÏƒÏÎ½Î´ÎµÏƒÎ¼Î¿Î¹</h3>
    <button id="themeToggle">ğŸŒ™ Dark</button>
  </header>

  <div class="topbar">
    <button id="addBtnTop">+ Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Î½Î­Î¿Ï… link</button>
    <button id="undoBtnTop" class="gray" disabled>â†© Î‘Î½Î±Î¯ÏÎµÏƒÎ·</button>
    <button id="backupBtn">Backup</button>
    <button id="restoreBtn">Restore</button>
  </div>

  <div id="categories"></div>
</div>

  <!-- ===== Î§Î©Î¡ÎŸÎ£ Î“Î™Î‘ ÎšÎ‘Î¤Î—Î“ÎŸÎ¡Î™Î•Î£ ===== -->
  <div id="categories"></div>
</div>

<footer>
  <div class="btnrow">
    <button id="addBtnFoot">+ Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Î½Î­Î¿Ï… link</button>
  </div>
  <div class="note">Î¦Ï„Î¹Î±Î³Î¼Î­Î½Î¿ Î¼Îµ Î±Î³Î¬Ï€Î· Î±Ï€ÏŒ Ï„Î¿ Doukas Pharmacy SupportÂ®</div>
</footer>

<!-- ===== MODAL ÎÎ•ÎŸÎ¥ LINK ===== -->
<div class="modal" id="modalForm">
  <div class="box">
    <h3 id="modalTitle">ÎÎ­Î¿ link</h3>
    <form id="linkForm" autocomplete="off">
      <!-- URL -->
      <div class="row"><input autocomplete="off" type="text" id="url" placeholder="Î”Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ· (URL)" required></div>
      <!-- ÎŒÎ½Î¿Î¼Î± -->
      <div class="row"><input autocomplete="off" type="text" id="name" placeholder="ÎŒÎ½Î¿Î¼Î± (max 13)"></div>
      <!-- Î ÎµÏÎ¹Î³ÏÎ±Ï†Î® -->
      <div class="row"><input autocomplete="off" type="text" id="desc" placeholder="Î ÎµÏÎ¹Î³ÏÎ±Ï†Î®"></div>

      <!-- Icon ÎµÏ€Î¹Î»Î¿Î³Î­Ï‚ -->
      <div class="row">
        <label style="font-size:13px;">Î•Î¹ÎºÎ¿Î½Î¯Î´Î¹Î¿</label>
        <div class="icon-row">
          <select id="iconMode">
            <option value="auto">Î‘Ï…Ï„ÏŒÎ¼Î±Ï„Î¿ favicon</option>
            <option value="builtin">Î•Î½ÏƒÏ‰Î¼Î±Ï„Ï‰Î¼Î­Î½Î¿ ÎµÎ¹ÎºÎ¿Î½Î¯Î´Î¹Î¿</option>
            <option value="upload">Î‘Î½Î­Î²Î±ÏƒÎ¼Î± ÎµÎ¹ÎºÏŒÎ½Î±Ï‚...</option>
          </select>
          <select id="builtinIcon" style="display:none">
            <option value="star">â˜… Î‘ÏƒÏ„Î­ÏÎ¹</option>
            <option value="heart">â¤ ÎšÎ±ÏÎ´Î¹Î¬</option>
            <option value="pill">ğŸ’Š Î§Î¬Ï€Î¹</option>
            <option value="firstaid">ğŸ©¹ Î ÏÏÏ„ÎµÏ‚ Î²Î¿Î®Î¸ÎµÎ¹ÎµÏ‚</option>
            <option value="link">ğŸ”— Link</option>
            <option value="doc">ğŸ“„ ÎˆÎ³Î³ÏÎ±Ï†Î¿</option>
          </select>
          <!-- TIFF Î±Ï€Î¿Ï†ÎµÏÎ³ÎµÏ„Î±Î¹: Î¼Î· Ï…Ï€Î¿ÏƒÏ„Î·ÏÎ¹Î¶ÏŒÎ¼ÎµÎ½Î¿ ÏƒÏ„Î¿Ï…Ï‚ browsers -->
          <input id="iconFile" type="file" accept="image/*,.ico,.png,.jpg,.jpeg,.webp,.svg" style="display:none">
        </div>
        <div class="icon-preview" id="iconPreview" style="display:none">
          <span>Î ÏÎ¿ÎµÏ€Î¹ÏƒÎºÏŒÏ€Î·ÏƒÎ·:</span><img id="iconPreviewImg" alt="icon">
        </div>
      </div>

      <!-- Î•Ï€Î¹Î»Î¿Î³Î® / Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯Î±Ï‚ -->
      <div class="row">
        <select id="categorySelect"></select>
        <input autocomplete="off" type="text" id="newCategory" placeholder="ÎÎ­Î± ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯Î±">
      </div>
      <!-- ÎšÎ¿Ï…Î¼Ï€Î¹Î¬ -->
      <div class="actions">
        <button type="button" id="cancelModal">Î†ÎºÏ…ÏÎ¿</button>
        <button type="submit">Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·</button>
      </div>
    </form>
  </div>
</div>

<!-- ===== MODAL Î Î‘Î›Î•Î¤Î‘Î£ Î§Î¡Î©ÎœÎ‘Î¤Î©Î ===== -->
<div class="modal" id="paletteModal">
  <div class="box">
    <h3>Î Î±Î»Î­Ï„Î± Î§ÏÏ‰Î¼Î¬Ï„Ï‰Î½</h3>
    <div class="row palette-row"><label for="bg1">Î¦ÏŒÎ½Ï„Î¿ 1</label><input type="color" id="bg1"><div id="swatch-bg1" class="color-swatch"></div></div>
    <div class="row palette-row"><label for="bg2">Î¦ÏŒÎ½Ï„Î¿ 2</label><input type="color" id="bg2"><div id="swatch-bg2" class="color-swatch"></div></div>
    <div class="row palette-row"><label for="card">ÎšÎ¬ÏÏ„Î±</label><input type="color" id="card"><div id="swatch-card" class="color-swatch"></div></div>
    <div class="row palette-row"><label for="text">ÎšÎµÎ¯Î¼ÎµÎ½Î¿</label><input type="color" id="text"><div id="swatch-text" class="color-swatch"></div></div>
    <div class="row palette-row"><label for="accent">ÎšÎ¿Ï…Î¼Ï€Î¹Î¬</label><input type="color" id="accent"><div id="swatch-accent" class="color-swatch"></div></div>
    <div class="actions">
      <button id="defaultPalette">Default</button>
      <button id="closePalette">ÎšÎ»ÎµÎ¯ÏƒÎ¹Î¼Î¿</button>
    </div>
  </div>
</div>

<!-- ===== ÎšÎ¡Î¥Î¦ÎŸ ÎšÎŸÎ¥ÎœÎ Î™ Î“Î™Î‘ Î Î‘Î›Î•Î¤Î‘ ===== -->
<div id="paletteBtn" data-tooltip="Î¡Ï…Î¸Î¼Î¯ÏƒÎµÎ¹Ï‚ Ï‡ÏÏ‰Î¼Î¬Ï„Ï‰Î½"></div>

<script>
/* ===============================
   ğŸ“Œ ÎšÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ· / ÎœÎµÏ„Î±Î²Î»Î·Ï„Î­Ï‚
   =============================== */
let categories = {};   // { ÎšÎ±Ï„Î·Î³Î¿ÏÎ¯Î±: [ {url,name,desc,iconType,iconValue,pinned?}, ... ] }
let catOrder = [];     // Î£ÎµÎ¹ÏÎ¬ ÎµÎ¼Ï†Î¬Î½Î¹ÏƒÎ·Ï‚ ÎºÎ±Ï„Î·Î³Î¿ÏÎ¹ÏÎ½
let editing = null;    // {cat, idx}
let historyStack = []; // Î™ÏƒÏ„Î¿ÏÎ¹ÎºÏŒ Î³Î¹Î± undo

// Default Ï‡ÏÏÎ¼Î±Ï„Î±
let themeDefault = {
  bg1:"#1f1f1f", bg2:"#232429", card:"#2b2d33", text:"#eaeef5", accent:"#2f80ed"
};

/* ===============================
   ğŸ“Œ SVG Î•Î¹ÎºÎ¿Î½Î¯Î´Î¹Î± (Î´Î¹Î±Ï†Î±Î½Î®)
   =============================== */
function svgIcon(kind, active=false){
  const color = active ? "#ffd54f" : "#e8eaed";
  if(kind==="edit") return `
    <svg viewBox="0 0 24 24" aria-hidden="true" role="img">
      <path fill="${color}" d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25z"/>
      <path fill="${color}" d="M20.71 7.04a1.003 1.003 0 0 0 0-1.42L18.37 3.29a1.003 1.003 0 0 0-1.42 0l-1.83 1.83 3.75 3.75 1.84-1.83z"/>
    </svg>`;
  if(kind==="delete") return `
    <svg viewBox="0 0 24 24" aria-hidden="true" role="img">
      <path fill="${color}" d="M16 9v10H8V9h8m-1.5-6h-5l-1 1H5v2h14V4h-3.5l-1-1z"/>
    </svg>`;
  // pin
  return `
    <svg viewBox="0 0 24 24" aria-hidden="true" role="img">
      <path fill="${color}" d="M16,12V5l1-1V3H7V4l1,1v7L5,15v2h6v4h2v-4h6v-2L16,12z"/>
    </svg>`;
}

/* ===============================
   ğŸ“Œ Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ· Î”ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½
   =============================== */
function saveData(){
  localStorage.setItem("categories", JSON.stringify(categories));
  localStorage.setItem("catOrder", JSON.stringify(catOrder));
}
function loadData(){
  categories = JSON.parse(localStorage.getItem("categories") || "{}");
  catOrder = JSON.parse(localStorage.getItem("catOrder") || "[]");
}

/* ===============================
   ğŸ“Œ Î˜Î­Î¼Î± / Î§ÏÏÎ¼Î±Ï„Î±
   =============================== */
function applyTheme(t){
  for(const [k,v] of Object.entries(t)){
    document.documentElement.style.setProperty("--"+k, v);
  }
}
function getTheme(){
  const cs = getComputedStyle(document.documentElement);
  return {
    bg1: cs.getPropertyValue("--bg1").trim(),
    bg2: cs.getPropertyValue("--bg2").trim(),
    card: cs.getPropertyValue("--card").trim(),
    text: cs.getPropertyValue("--text").trim(),
    accent: cs.getPropertyValue("--accent").trim()
  };
}
function saveTheme(t){ localStorage.setItem("theme", JSON.stringify(t)); }
function loadTheme(){
  const t = JSON.parse(localStorage.getItem("theme") || "null") || themeDefault;
  applyTheme(t);
  ["bg1","bg2","card","text","accent"].forEach(id=>{
    const el = document.getElementById(id);
    if(el) el.value = t[id];
  });
}

/* ===============================
   ğŸ“Œ Undo / Î™ÏƒÏ„Î¿ÏÎ¹ÎºÏŒ
   =============================== */
function pushHistory(){
  historyStack.push(JSON.stringify({
    categories: JSON.parse(JSON.stringify(categories)),
    catOrder: [...catOrder],
    theme: getTheme()
  }));
  if(historyStack.length > 80) historyStack.shift();
  updateUndoBtn();
}
function updateUndoBtn(){
  const b = document.getElementById("undoBtnTop");
  if(historyStack.length === 0){ b.disabled = true; b.classList.add("gray"); }
  else { b.disabled = false; b.classList.remove("gray"); }
}
function undo(){
  if(historyStack.length === 0) return;
  const snap = JSON.parse(historyStack.pop());
  categories = snap.categories;
  catOrder = snap.catOrder;
  applyTheme(snap.theme);
  saveData(); saveTheme(snap.theme);
  render();
  updateUndoBtn();
}

/* ===============================
   ğŸ“Œ Î’Î¿Î·Î¸Î¿Î¯
   =============================== */
function normalizeUrl(u){
  if(!u) return "";
  let s = u.trim();
  if(!/^https?:\/\//i.test(s)){
    if(/^www\./i.test(s)) s = "https://" + s;
    else s = "https://" + s;
  }
  return s;
}
function dedupeAdd(cat, linkObj){
  const url = linkObj.url;
  if(!(categories[cat])) categories[cat] = [];
  if(categories[cat].some(L => (L.url||"").toLowerCase() === url.toLowerCase())) return false;
  categories[cat].push(linkObj);
  return true;
}
function builtinToDataUrl(kind){
  const map = {
    star:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="white" d="M12 17.27 18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>',
    heart:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="white" d="M12 21s-6.716-4.928-9.428-8.35C-0.287 9.39 1.38 5 5.6 5c2.08 0 3.512 1.124 4.4 2.36C10.888 6.124 12.32 5 14.4 5 18.62 5 20.287 9.39 17.428 12.65 14.716 16.072 12 21 12 21z"/></svg>',
    pill:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="white" d="M4.22 19.78a3.75 3.75 0 0 1 0-5.3l6.26-6.26a3.75 3.75 0 0 1 5.3 5.3l-6.26 6.26a3.75 3.75 0 0 1-5.3 0Zm7.42-12.02 4.6 4.6"/></svg>',
    firstaid:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><rect x="3" y="7" width="18" height="14" rx="2" ry="2" fill="white" opacity="0.15"/><path fill="white" d="M13 6h-2V4h2v2Zm-3 5H7v2h3v3h2v-3h3v-2h-3V8h-2v3Z"/></svg>',
    link:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="white" d="M10.59 13.41a1.996 1.996 0 0 0 2.82 0l3.59-3.59a2 2 0 1 0-2.83-2.83l-1 1 1.41 1.41 1-1a.5.5 0 1 1 .71.71l-3.59 3.59a.996.996 0 1 1-1.41-1.41l1-1-1.41-1.41-1 1a2 2 0 0 0 0 2.83Z"/></svg>',
    doc:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="white" d="M6 2h9l5 5v13a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2Zm8 1.5V8h4.5L14 3.5Z"/></svg>'
  };
  const svg = map[kind] || map.link;
  return 'data:image/svg+xml;utf8,' + encodeURIComponent(svg);
}

/* ===============================
   ğŸ“Œ Render â€” Î£Ï‡ÎµÎ´Î¯Î±ÏƒÎ· UI (Î¼Îµ Pin)
   =============================== */
function render(){
  const wrap = document.getElementById("categories");
  wrap.innerHTML = "";

  catOrder.forEach(cat=>{
    const sec = document.createElement("div");
    sec.className = "category";
    sec.draggable = true;
    sec.dataset.cat = cat;

    sec.innerHTML = `
      <div class="category-title">
        <h2>${cat}</h2>
        <div class="cat-actions">
          <span class="cat-btn rename" data-tooltip="ÎœÎµÏ„Î¿Î½Î¿Î¼Î±ÏƒÎ¯Î±">âœ</span>
          <span class="cat-btn delcat" data-tooltip="Î”Î¹Î±Î³ÏÎ±Ï†Î®">ğŸ—‘</span>
        </div>
      </div>`;

    const grid = document.createElement("div");
    grid.className = "grid";
    grid.dataset.cat = cat;

    const list = (categories[cat] || []);
    // Î£ÎµÎ¹ÏÎ¬: pinned Ï€ÏÏÏ„Î±, Î±Î»Î»Î¬ ÎºÏÎ±Ï„Î¬Î¼Îµ indices
    const orderIdx = list.map((_,i)=>i).sort((a,b)=>{
      const pa = !!(list[a] && list[a].pinned), pb = !!(list[b] && list[b].pinned);
      if(pa===pb) return a-b;
      return pb - pa;
    });

    orderIdx.forEach(idx=>{
      const l = list[idx] || {};
      // icon source
      let iconSrc = "";
      if(l.iconType === "upload" && l.iconValue){ iconSrc = l.iconValue; }
      else if(l.iconType === "builtin" && l.iconValue){ iconSrc = builtinToDataUrl(l.iconValue); }
      else {
        let domain=""; try{ domain=(new URL(l.url)).hostname; }catch{}
        const gg = `https://www.google.com/s2/favicons?sz=64&domain=${domain}`;
        iconSrc = gg;
      }

      const card = document.createElement("div");
      card.className="card";
      card.draggable=true;
      card.dataset.cat=cat;
      card.dataset.idx=idx;
      if(l.pinned) card.classList.add("pinned");

      card.innerHTML = `
        <div class="ctrl-left">
          <button class="ctrl-btn edit" aria-label="Î•Ï€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¯Î±">
            ${svgIcon('edit')}
          </button>
        </div>
        <div class="ctrl-right">
          <button class="ctrl-btn del" aria-label="Î”Î¹Î±Î³ÏÎ±Ï†Î®">
            ${svgIcon('delete')}
          </button>
        </div>
        <div class="ctrl-bottom">
          <button class="ctrl-btn pin" aria-label="Pin / Unpin">
            ${svgIcon('pin', !!l.pinned)}
          </button>
        </div>
        <a href="${l.url}" target="_blank" draggable="false">
          <img class="favicon" src="${iconSrc}"
            onerror="this.onerror=null; (function(img){
              try{
                const d='${builtinToDataUrl("link")}';
                img.src=d;
              }catch(e){}
            })(this);">
          <div class="link-title" style="color:var(--text)">${(l.name||"").slice(0,13)}</div>
          <div class="link-desc">${l.desc||""}</div>
        </a>`;

      grid.appendChild(card);
    });

    sec.appendChild(grid);
    wrap.appendChild(sec);
  });
}

/* ===============================
   ğŸ“Œ Listeners â€” ÎšÎ¿Ï…Î¼Ï€Î¹Î¬ ÎºÎ±Î¹ Î•Î½Î­ÏÎ³ÎµÎ¹ÎµÏ‚
   =============================== */
// Modal Î½Î­Î¿ link
["addBtnTop","addBtnFoot"].forEach(id =>
  document.getElementById(id).onclick = () => {
    editing = null;
    document.getElementById("modalTitle").innerText = "ÎÎ­Î¿ link";
    document.getElementById("linkForm").reset();
    document.getElementById("iconPreview").style.display="none";
    document.getElementById("builtinIcon").style.display="none";
    document.getElementById("iconFile").style.display="none";
    document.getElementById("iconMode").value="auto";

    document.getElementById("categorySelect").innerHTML =
      catOrder.map(c=>`<option>${c}</option>`).join("");

    document.getElementById("modalForm").style.display = "flex";
  }
);
document.getElementById("cancelModal").onclick =
  () => document.getElementById("modalForm").style.display = "none";

// Icon mode switching
const iconModeEl = document.getElementById("iconMode");
const builtinEl  = document.getElementById("builtinIcon");
const iconFileEl = document.getElementById("iconFile");
const iconPrev   = document.getElementById("iconPreview");
const iconPrevImg= document.getElementById("iconPreviewImg");

iconModeEl.addEventListener("change", ()=>{
  builtinEl.style.display = iconModeEl.value==="builtin" ? "inline-block" : "none";
  iconFileEl.style.display= iconModeEl.value==="upload"  ? "inline-block" : "none";
  iconPrev.style.display  = "none";
});
builtinEl.addEventListener("change", ()=>{
  const url = builtinToDataUrl(builtinEl.value);
  iconPrevImg.src = url; iconPrev.style.display="flex";
});
iconFileEl.addEventListener("change", ()=>{
  const f = iconFileEl.files && iconFileEl.files[0];
  if(!f) return;
  const r = new FileReader();
  r.onload = () => { iconPrevImg.src = r.result; iconPrev.style.display="flex"; };
  r.readAsDataURL(f);
});

// Î¥Ï€Î¿Î²Î¿Î»Î® Ï†ÏŒÏÎ¼Î±Ï‚
const urlEl = document.getElementById("url"),
      nameEl = document.getElementById("name"),
      descEl = document.getElementById("desc"),
      catSel = document.getElementById("categorySelect"),
      newCatEl = document.getElementById("newCategory");

document.getElementById("linkForm").onsubmit = e => {
  e.preventDefault();
  const url = normalizeUrl(urlEl.value);
  const name = nameEl.value.trim();
  const desc = descEl.value.trim();
  if(!url){ alert("Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ URL"); return; }

  let cat = catSel.value, newCat = newCatEl.value.trim();
  if(newCat) cat = newCat;

  if(!categories[cat]){ pushHistory(); categories[cat]=[]; catOrder.push(cat); }

  // ÎµÎ¹ÎºÎ¿Î½Î¯Î´Î¹Î¿
  let iconType = iconModeEl.value;
  let iconValue = null;
  if(iconType==="builtin"){
    iconValue = builtinEl.value || "link";
  }else if(iconType==="upload"){
    if(iconFileEl.files && iconFileEl.files[0]){
      iconValue = iconPrevImg.src || null;
    }else{
      iconType = "auto";
    }
  }

  pushHistory();
  const baseObj = { url, name, desc, iconType, iconValue };
  if(editing){
    const prev = categories[editing.cat][editing.idx] || {};
    const updated = { ...baseObj, pinned: !!prev.pinned }; // ÎºÏÎ±Ï„Î¬Î¼Îµ Ï„Î¿ pinned
    categories[editing.cat][editing.idx] = updated;
  }else{
    const linkObj = { ...baseObj, pinned:false };
    dedupeAdd(cat, linkObj);
  }

  saveData(); render();
  document.getElementById("modalForm").style.display = "none";
};

// Î•Î½Î­ÏÎ³ÎµÎ¹ÎµÏ‚ ÏƒÎµ ÎºÎ¬ÏÏ„ÎµÏ‚/ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯ÎµÏ‚
document.addEventListener("click", e => {
  // Î”Î¹Î±Î³ÏÎ±Ï†Î® link
  if(e.target.closest(".del")){
    const c = e.target.closest(".card");
    pushHistory();
    categories[c.dataset.cat].splice(+c.dataset.idx,1);
    saveData(); render();
  }

  // Î•Ï€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¯Î± link
  if(e.target.closest(".edit")){
    const c = e.target.closest(".card");
    editing = {cat:c.dataset.cat, idx:+c.dataset.idx};
    const l = categories[editing.cat][editing.idx];
    urlEl.value=l.url; nameEl.value=l.name||""; descEl.value=l.desc||"";
    catSel.innerHTML = catOrder.map(x=>
      `<option ${x===editing.cat?"selected":""}>${x}</option>`).join("");
    newCatEl.value="";

    // Ï€ÏÎ¿ÎµÏ€Î¹Î»Î¿Î³Î® icon ÏƒÏ„Î± Ï€ÎµÎ´Î¯Î±
    iconModeEl.value = l.iconType || "auto";
    builtinEl.style.display = iconModeEl.value==="builtin" ? "inline-block" : "none";
    iconFileEl.style.display= iconModeEl.value==="upload"  ? "inline-block" : "none";
    iconPrev.style.display  = "none";
    if(l.iconType==="builtin"){
      builtinEl.value = l.iconValue || "link";
      iconPrevImg.src = builtinToDataUrl(builtinEl.value); iconPrev.style.display="flex";
    }else if(l.iconType==="upload" && l.iconValue){
      iconPrevImg.src = l.iconValue; iconPrev.style.display="flex";
    }

    document.getElementById("modalTitle").innerText="Î•Ï€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¯Î± link";
    document.getElementById("modalForm").style.display="flex";
  }

  // ÎœÎµÏ„Î¿Î½Î¿Î¼Î±ÏƒÎ¯Î± ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯Î±Ï‚
  if(e.target.closest(".rename")){
    const cat = e.target.closest(".category").dataset.cat;
    const newN = prompt("ÎÎ­Î¿ ÏŒÎ½Î¿Î¼Î±:",cat);
    if(newN && newN!==cat){
      pushHistory();
      categories[newN]=categories[cat];
      delete categories[cat];
      catOrder[catOrder.indexOf(cat)]=newN;
      saveData(); render();
    }
  }

  // Î”Î¹Î±Î³ÏÎ±Ï†Î® ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯Î±Ï‚
  if(e.target.closest(".delcat")){
    const cat = e.target.closest(".category").dataset.cat;
    if(confirm("Î”Î¹Î±Î³ÏÎ±Ï†Î® "+cat+";")){
      pushHistory();
      delete categories[cat];
      catOrder=catOrder.filter(c=>c!==cat);
      saveData(); render();
    }
  }

  // Pin / Unpin
  if(e.target.closest(".pin")){
    const card = e.target.closest(".card");
    const cat = card.dataset.cat;
    const idx = +card.dataset.idx;
    const item = categories[cat][idx];
    if(!item) return;
    pushHistory();
    item.pinned = !item.pinned;
    saveData(); render();
  }
});

/* ===============================
   ğŸ“Œ Backup & Restore
   =============================== */
document.getElementById("backupBtn").onclick=()=>{
  const blob=new Blob([JSON.stringify({
    categories,catOrder,theme:getTheme(),version:3
  },null,2)],{type:"application/json"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="bookmarks_backup.json";
  a.click();
};

document.getElementById("restoreBtn").onclick=()=>{
  const choice = confirm("OK: Î•Ï€Î±Î½Î±Ï†Î¿ÏÎ¬ Î±Ï€ÏŒ JSON backup\nCancel: Î•Î¹ÏƒÎ±Î³Ï‰Î³Î® Î±Ï€ÏŒ HTML ÏƒÎµÎ»Î¹Î´Î¿Î´ÎµÎ¯ÎºÏ„ÎµÏ‚");
  const inp=document.createElement("input");
  inp.type="file"; inp.accept = choice ? ".json" : ".html,.htm,.txt";
  inp.onchange=()=>{
    const r=new FileReader();
    r.onload=()=>{
      if(choice){
        try{
          const d=JSON.parse(r.result);
          if(d.categories && d.catOrder){
            pushHistory();
            categories=d.categories;catOrder=d.catOrder;
            if(d.theme){applyTheme(d.theme);saveTheme(d.theme);}
            saveData(); render(); updateUndoBtn();
          } else { alert("ÎœÎ· Î­Î³ÎºÏ…ÏÎ¿ JSON."); }
        }catch{ alert("ÎœÎ· Î­Î³ÎºÏ…ÏÎ¿ JSON."); }
      } else {
        const merge = confirm("OK: Î£Ï…Î³Ï‡ÏÎ½ÎµÏ…ÏƒÎ· (Î´ÎµÎ½ Ï€ÏÎ¿ÏƒÎ¸Î­Ï„ÎµÎ¹ Î´Î¹Ï€Î»Î¬)\nCancel: Î‘Î½Ï„Î¹ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·");
        const parser = new DOMParser();
        const doc = parser.parseFromString(r.result,"text/html");
        const anchors = Array.from(doc.querySelectorAll("a[href]"));
        if(anchors.length===0){ alert("Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎ±Î½ links ÏƒÏ„Î¿ HTML."); return; }
        if(!merge){ pushHistory(); categories={}; catOrder=[]; }

        function closestHeading(el){
          let cur=el; for(let i=0;i<4 && cur;i++, cur=cur.previousElementSibling){
            if(/H[1-3]/.test(cur.tagName)) return cur.textContent.trim();
          }
          let p=el.parentElement; while(p){
            const h = p.querySelector("h3,h2,h1"); if(h) return h.textContent.trim();
            p=p.parentElement;
          }
          return "Î•Î¹ÏƒÎ±Î³Ï‰Î³Î®";
        }

        let added=0;
        anchors.forEach(a=>{
          let href=a.getAttribute("href")||"";
          if(!href) return;
          if(!/^https?:\/\//i.test(href) && !/^www\./i.test(href)) return;
          const url = normalizeUrl(href);
          const name = (a.getAttribute("title")||a.textContent||"").trim();
          const desc = "";
          const cat = closestHeading(a);
          if(!(categories[cat])){ categories[cat]=[]; catOrder.push(cat); }
          const ok = dedupeAdd(cat, {url,name,desc,iconType:"auto",iconValue:null,pinned:false});
          if(ok) added++;
        });

        saveData(); render(); updateUndoBtn();
        alert("Î•Î¹ÏƒÎ±Î³Ï‰Î³Î® HTML Î¿Î»Î¿ÎºÎ»Î·ÏÏÎ¸Î·ÎºÎµ. Î ÏÎ¿ÏƒÏ„Î­Î¸Î·ÎºÎ±Î½ "+added+" links.");
      }
    };
    r.readAsText(inp.files[0]);
  };
  inp.click();
};

/* ===============================
   ğŸ“Œ Î Î±Î»Î­Ï„Î± Î§ÏÏ‰Î¼Î¬Ï„Ï‰Î½
   =============================== */
document.getElementById("paletteBtn").onclick=
  ()=>document.getElementById("paletteModal").style.display="flex";
document.getElementById("closePalette").onclick=
  ()=>document.getElementById("paletteModal").style.display="none";

["bg1","bg2","card","text","accent"].forEach(id=>{
  const el = document.getElementById(id);
  if(!el) return;
  el.oninput=e=>{
    document.documentElement.style.setProperty("--"+id,e.target.value);
    // update swatch if exists
    const sw = document.getElementById('swatch-'+id);
    if(sw) sw.style.background = e.target.value;
    pushHistory();
    saveTheme(getTheme());
  };
});
document.getElementById("defaultPalette").onclick=()=>{
  applyTheme(themeDefault);
  saveTheme(themeDefault);
  ["bg1","bg2","card","text","accent"].forEach(id=>{
    const el=document.getElementById(id);
    if(el) el.value = themeDefault[id];
    const sw = document.getElementById('swatch-'+id);
    if(sw) sw.style.background = themeDefault[id];
  });
  pushHistory();
};

/* ===============================
   ğŸ“Œ Undo
   =============================== */
document.getElementById("undoBtnTop").onclick=undo;

/* ===============================
   ğŸ“Œ Drag & Drop (links ÎºÎ±Î¹ ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯ÎµÏ‚)
   =============================== */
let dragSrc=null;
document.addEventListener("dragstart",e=>{
  const c=e.target.closest(".card"),
        cat=e.target.closest(".category");
  if(c){dragSrc=c;} else if(cat){dragSrc=cat;}
});
document.addEventListener("dragover",e=>{
  if(e.target.closest(".card")||e.target.closest(".category")) e.preventDefault();
});
document.addEventListener("drop",e=>{
  e.preventDefault(); if(!dragSrc) return;
  const card=e.target.closest(".card"),
        cat=e.target.closest(".category");

  // ÎœÎµÏ„Î±Ï†Î¿ÏÎ¬ link
  if(dragSrc.classList.contains("card")){
    const f=dragSrc.dataset.cat, i=+dragSrc.dataset.idx, l=categories[f][i];
    pushHistory();
    categories[f].splice(i,1);
    if(card && card!==dragSrc){
      categories[card.dataset.cat].splice(+card.dataset.idx,0,l);
    }else if(cat){
      categories[cat.dataset.cat].push(l);
    }else{
      categories[f].push(l);
    }
    saveData(); render();
  }

  // ÎœÎµÏ„Î±Ï†Î¿ÏÎ¬ ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯Î±Ï‚
  if(dragSrc.classList.contains("category") && cat){
    const fi=catOrder.indexOf(dragSrc.dataset.cat),
          ti=catOrder.indexOf(cat.dataset.cat);
    pushHistory();
    catOrder.splice(fi,1);
    catOrder.splice(ti,0,dragSrc.dataset.cat);
    saveData(); render();
  }
  dragSrc=null;
});

/* ===============================
   ğŸ“Œ Favicon (Ï„Ï…Ï‡Î±Î¯Î¿) & Init + Theme toggle
   =============================== */
function setRandomFavicon(){
  try{
    const chars = ['â˜…','â¤','ğŸ’Š','ğŸ”—','âš•'];
    const ch = chars[Math.floor(Math.random()*chars.length)];
    const colors = ['#f4a261','#2f80ed','#ffd54f','#f472b6','#34d399'];
    const color = colors[Math.floor(Math.random()*colors.length)];
    const svg = `<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'><rect rx='12' width='64' height='64' fill='${color}'/><text x='50%' y='56%' font-size='36' text-anchor='middle' fill='white' font-family='Arial, Helvetica, sans-serif'>${ch}</text></svg>`;
    const url = 'data:image/svg+xml;utf8,'+encodeURIComponent(svg);
    let link = document.getElementById('favicon');
    if(!link){ link=document.createElement('link'); link.rel='icon'; link.id='favicon'; document.head.appendChild(link); }
    link.href = url;
  }catch(e){ /* non-critical */ }
}

loadData(); loadTheme();
if(catOrder.length===0){
  categories={"Î•Î¹ÏƒÎ±Î³Ï‰Î³Î®":[]};
  catOrder=["Î•Î¹ÏƒÎ±Î³Ï‰Î³Î®"];
  saveData();
}
render(); updateUndoBtn();

// update palette swatches initial
["bg1","bg2","card","text","accent"].forEach(id=>{
  const el=document.getElementById(id);
  const sw=document.getElementById('swatch-'+id);
  if(el && sw) sw.style.background = el.value || getTheme()[id];
});

/* ===============================
   ğŸ“Œ Î˜Î­Î¼Î±Ï„Î±
   =============================== */
function getTheme(){
  const cs = getComputedStyle(document.documentElement);
  return {
    bg1: cs.getPropertyValue("--bg1").trim(),
    bg2: cs.getPropertyValue("--bg2").trim(),
    card: cs.getPropertyValue("--card").trim(),
    text: cs.getPropertyValue("--text").trim(),
    accent: cs.getPropertyValue("--accent").trim()
  };
}
function applyTheme(t){
  for(const [k,v] of Object.entries(t)){
    document.documentElement.style.setProperty("--"+k, v);
  }
}
function saveTheme(t){ localStorage.setItem("theme", JSON.stringify(t)); }
function loadTheme(){
  const t = JSON.parse(localStorage.getItem("theme") || "null");
  if(t) applyTheme(t);
}

let lightTheme = { 
  bg1:"#f0f4f8", 
  bg2:"#ffffff", 
  card:"#e0e7ef", 
  text:"#2c3e50", 
  accent:"#1565c0"   // Î¼Ï€Î»Îµ Î³Î¹Î± Î­Î½Ï„Î¿Î½Î· Î±Î½Ï„Î¯Î¸ÎµÏƒÎ· ÏƒÎµ Î±Î½Î¿Î¹Ï‡Ï„ÏŒ Ï†ÏŒÎ½Ï„Î¿
};
let darkTheme  = { 
  bg1:"#0d1b2a", 
  bg2:"#1b263b", 
  card:"#415a77", 
  text:"#e0e1dd", 
  accent:"#00bcd4"   // Î³Î±Î»Î¬Î¶Î¹Î¿ Î³Î¹Î± Î­Î½Ï„Î¿Î½Î· Î±Î½Ï„Î¯Î¸ÎµÏƒÎ· ÏƒÎµ ÏƒÎºÎ¿ÏÏÎ¿ Ï†ÏŒÎ½Ï„Î¿
};

function updateThemeButton(){
  const current = getTheme();
  const isDark = current.bg1.toLowerCase() === darkTheme.bg1.toLowerCase();
  document.getElementById("themeToggle").innerText = isDark ? "ğŸŒ™ Dark" : "ğŸŒ Light";
}

document.getElementById("themeToggle").addEventListener("click", () => {
  const current = getTheme();
  const isDark = current.bg1.toLowerCase() === darkTheme.bg1.toLowerCase();
  const t = isDark ? lightTheme : darkTheme;
  applyTheme(t);
  saveTheme(t);
  updateThemeButton();
});

// set random favicon once
setRandomFavicon();
</script>
</body>
</html>
